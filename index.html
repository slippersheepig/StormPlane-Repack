<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>沙漠风暴REPACK</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <canvas id="bgCanvas" aria-hidden="true"></canvas>

  <div id="game-container" aria-hidden="false" style="position:fixed;inset:0;z-index:0;pointer-events:none;">
    <canvas id="game-canvas" width="640" height="480"
            style="width:100%;height:100%;display:block;pointer-events:auto;"></canvas>
  </div>

  <header id="topbar" style="position:fixed;top:0;left:0;right:0;z-index:60;pointer-events:none;">
    <div id="hud" style="pointer-events:auto;">
      <div id="score">分数：0</div>
      <div id="lives">生命：100</div>
      <div id="level">难度：普通</div>
    </div>
  </header>

  <div id="menu" style="z-index:70;pointer-events:auto;">
    <div class="panel">
      <h1>逸一世误一时</h1>
      <div class="btns">
        <button data-diff="easy">简单</button>
        <button data-diff="normal" class="active">普通</button>
        <button data-diff="hard">困难</button>
      </div>
      <button id="start-btn">开始游戏</button>
    </div>
  </div>

  <script type="module">
    import { loadPyodide } from "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.mjs";
    const pyodide = await loadPyodide();

    async function main() {
      try {
        // 写入 utils.py 到虚拟文件系统
        const utilsResp = await fetch("utils.py");
        const utilsCode = await utilsResp.text();
        pyodide.FS.writeFile("utils.py", utilsCode);

        // 加载并运行 main.py
        const mainResp = await fetch("main.py");
        const mainCode = await mainResp.text();
        await pyodide.runPythonAsync(mainCode);
      } catch (err) {
        console.error("Failed to load/run Python code:", err);
      }
    }
    main();
  </script>
</body>
</html>
